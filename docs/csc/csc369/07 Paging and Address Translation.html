<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-csc/csc369/07 Paging and Address Translation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Paging and Address Translation | Yorafa&#x27;s Note</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://note.yorafa.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://note.yorafa.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://note.yorafa.com/docs/csc/csc369/07 Paging and Address Translation"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Paging and Address Translation | Yorafa&#x27;s Note"><meta data-rh="true" name="description" content="We need relocation, but how we do it?"><meta data-rh="true" property="og:description" content="We need relocation, but how we do it?"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://note.yorafa.com/docs/csc/csc369/07 Paging and Address Translation"><link data-rh="true" rel="alternate" href="https://note.yorafa.com/docs/csc/csc369/07 Paging and Address Translation" hreflang="en"><link data-rh="true" rel="alternate" href="https://note.yorafa.com/docs/csc/csc369/07 Paging and Address Translation" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7b08fd3c.css">
<script src="/assets/js/runtime~main.bbaa4603.js" defer="defer"></script>
<script src="/assets/js/main.65eabbe9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/favicon.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Yorafa&#x27;s Note</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Notes</a><a href="https://home.yorafa.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Nav</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Yorafa/coursenote" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/basic">Basic</a><button aria-label="Expand sidebar category &#x27;Basic&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/csc">CSC</a><button aria-label="Collapse sidebar category &#x27;CSC&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/csc/csc209">CSC209 Software Tools and Systems Programming</a><button aria-label="Expand sidebar category &#x27;CSC209 Software Tools and Systems Programming&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/csc/csc236">CSC236 Introduction to the Theory of Computation</a><button aria-label="Expand sidebar category &#x27;CSC236 Introduction to the Theory of Computation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/csc/csc263">CSC263 Data Structures and Analysis</a><button aria-label="Expand sidebar category &#x27;CSC263 Data Structures and Analysis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/csc/csc369">CSC369: Operating Systems</a><button aria-label="Collapse sidebar category &#x27;CSC369: Operating Systems&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/csc/csc369/00 intro">OS - three piece</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/csc/csc369/01 process">Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/csc/csc369/02 system call">System Call</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/csc/csc369/03 thread">Thread</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/csc/csc369/04 Synchronization">Synchronization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/csc/csc369/05 Scheduling">Scheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/csc/csc369/06 Memory Management">Memory Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/csc/csc369/07 Paging and Address Translation">Paging and Address Translation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/csc/csc369/08 Principles and Policies for Memory Management">Principles and Policies for Memory Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/csc/csc369/09 file system introduction">File System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/csc/csc369/10 file system reliability">File System Reliability</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/csc/csc413">CSC413 Neural Networks and Deep Learning</a><button aria-label="Expand sidebar category &#x27;CSC413 Neural Networks and Deep Learning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/mat">MAT</a><button aria-label="Expand sidebar category &#x27;MAT&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/sta">STA</a><button aria-label="Expand sidebar category &#x27;STA&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/csc"><span itemprop="name">CSC</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/csc/csc369"><span itemprop="name">CSC369: Operating Systems</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Paging and Address Translation</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Paging and Address Translation</h1>
<p>We need relocation, but how we do it?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hardware-support">Hardware Support<a href="#hardware-support" class="hash-link" aria-label="Direct link to Hardware Support" title="Direct link to Hardware Support">​</a></h2>
<p>Hardware provides relocation registers to support. It add relative address to process starting address to form real address and check that address generated is within limits of process&#x27;s space. There are two relocation registers: base and limit</p>
<ul>
<li>when process is assigned to CPU, load base register with start address of process</li>
<li>load limit register with last logical address of process</li>
<li>on memory reference instruction such as load, store, add base to logical address and compare with limit<!-- -->
<ul>
<li>if (addr &lt; base || addr &gt;= base + limit) then trap to OS since illegal address</li>
</ul>
</li>
<li>store base and limit for each process as part of the PCB</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="paging">Paging<a href="#paging" class="hash-link" aria-label="Direct link to Paging" title="Direct link to Paging">​</a></h2>
<p>recall some problems of partition:</p>
<ul>
<li>fixed partition: internal fragmentation and need overlays</li>
<li>dynamic partition: external fragmentation and managingavailable space</li>
<li>processes must be allocated to contiguous blocks of physical memory, but<!-- -->
<ul>
<li>hard to figure out size of block</li>
<li>requirement of memory changing over time</li>
</ul>
</li>
</ul>
<p>Paging is the solution.</p>
<ul>
<li>Logically partition physical memory into equal, fixed-size chunks (<strong>page frames</strong>)</li>
<li>Divide process&#x27; memory into chunks of the same size (<strong>virtual pages</strong>)</li>
<li>any virtual page can be assigned to any free page frame, which solve:<!-- -->
<ul>
<li>no external fragmentation</li>
<li>Internal fragmentation is at most a fraction of one page per region</li>
</ul>
</li>
<li>Possible page frame sizes are restricted to powers of 2 to simplify address translation</li>
<li>Pages can be moved between memory and disk (<strong>demand paging</strong>, method of memory management)</li>
</ul>
<p>Paging simplies virtualization of memory where:</p>
<ul>
<li>process doesn&#x27;t need to use a contiguous region of physical memory</li>
<li>no more need for base and limit registers (<strong>page table</strong> is used instead)<!-- -->
<ul>
<li>page tables store the mapping of pages to frams. In other word, page table records which physical frame holds each page.</li>
<li>CPU use one register to find the start of the page table in memory (page table base register or PTBR)</li>
<li>One page table entry per page</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="support-for-paging">Support for Paging<a href="#support-for-paging" class="hash-link" aria-label="Direct link to Support for Paging" title="Direct link to Support for Paging">​</a></h3>
<p>We know there is a translation but where does it happen? Hardware (MMU) converts virtual address to physical address using the Page Table. OS maintains a page table for each process.</p>
<ul>
<li>The logical address are basically <strong>page number + page offset</strong> (here + not mean add instead it&#x27;s concating) where:<!-- -->
<ul>
<li>page number = logical address / page size (first n bits of logical address)</li>
<li>page offset = logical address % page size (last m bits of logical address)</li>
</ul>
</li>
<li>on each memory reference, processor translates the page number to its frame number and adds the offset to generate a physical address. <strong>physical address = frame number + page offset</strong> (concat again)<!-- -->
<ul>
<li>frame number = page table[page number], frame number should keep the length of the page size</li>
</ul>
</li>
</ul>
<p>OS uses main memory as page cache of all data allocated in the system.</p>
<ul>
<li>initially, all pages are allocated from memory</li>
<li>when memory is full, allocating a page in memory requires some other page to be evicted from momory to disk (replacement with page on the disk, whole movement is done by OS and transparent to the application)</li>
<li>OS keep track of use of each physical frame</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="page-faults">Page Faults<a href="#page-faults" class="hash-link" aria-label="Direct link to Page Faults" title="Direct link to Page Faults">​</a></h3>
<p>As mentioned, page can be evicted from memory. What happens when a processes a page that been evicted?</p>
<ol>
<li>when os evicts a page, the OS sets the PTE as invalid and stores the location of the page in the swap file in the PTE</li>
<li>when the process tries to access the page, the invalid PTE will cause a trap (the <strong>page fault</strong>)</li>
<li>trap will run OS page fault handler</li>
<li>handler uses the invalid PTE to located page in swap file</li>
<li>reads page into a physical frame, updates PTE to point to it</li>
<li>resume process</li>
</ol>
<p>It&#x27;s expensive to handling page faults which may require 2 disk accesses so that OS keeps some free pages so that allocations do not always cause evictions.</p>
<p>There are two option of managing swap space:</p>
<ol>
<li>use raw disk partition:<!-- -->
<ul>
<li>faster (skip file system) but requires disk reformat to resize</li>
</ul>
</li>
<li>use ordinary large file in file system:<!-- -->
<ul>
<li>more flexible (can grow if more swap space is needed) but swap file can become fragmented</li>
</ul>
</li>
</ol>
<p>In conclusion, when should the swap space be allocated/freed?</p>
<ul>
<li>it can be done on process startup/shutdown: ensure every process has enough swap space but may waste space</li>
<li>it can be done on pageout/pagein: only allocate swap space when needed but may cause page fault during process startup</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-of-address-translation">example of address translation<a href="#example-of-address-translation" class="hash-link" aria-label="Direct link to example of address translation" title="Direct link to example of address translation">​</a></h4>
<p>suppose address are 16 bits(i.e. 16 numbers of 01), pages are 1024 bytes, and following page table:</p>
<table><thead><tr><th>Page</th><th>Frame</th></tr></thead><tbody><tr><td>0</td><td>B</td></tr><tr><td>1</td><td>F</td></tr><tr><td>2</td><td>7</td></tr><tr><td>3</td><td>1C</td></tr></tbody></table>
<p>then we have:</p>
<ul>
<li>page number = logical address / page size = 2^16 / 1024 = 2^6 or in binary 6 bits format, that is the first 6 bits of logical address</li>
<li>page offset = 2^10 or in binary 10 bits format, the rest 10 bits of logical address</li>
<li>frame number = page table[page number]</li>
</ul>
<p>let&#x27;s try 0x0DDE: first we have 0b0000 1101 1101 1110 for binary format, then we have:</p>
<ul>
<li>page number = 0b0000 1101 1101 1110 / 2^10 = 0b0000 11 = 3</li>
<li>page offset = 0b0000 1101 1101 1110 % 2^10 = 0b01 1101 1110 = 0x1DE</li>
<li>frame number = page table[page number] = page table[3] = 0x1C</li>
<li>physical address = frame number + page offset = 0x1C + 0x1DE = 0b0111 00 (in page size) + 0b01 1101 1110 (in page offset) = 0b0111 0001 1101 1110 = 0x71DE</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="more-on-page-table">More on Page Table<a href="#more-on-page-table" class="hash-link" aria-label="Direct link to More on Page Table" title="Direct link to More on Page Table">​</a></h3>
<p>Generally for a 32 bits page table entry, we have: MRVRWX + Page Frame Number (26 bits)</p>
<ul>
<li>M(modified): if page has been written, set to 1</li>
<li>R(referenced): if page has been read or write, set to 1</li>
<li>V(valid): if page is in memory(in use), set to 1</li>
</ul>
<p>We know page tables are maintained by OS and stored in memory. But where exactly (which address space)?</p>
<ul>
<li>When store in the physical memory we use direct mapping method (does not use TLB) which means the same address in virtual memory and physical memory.<!-- -->
<ul>
<li>not exactly the same, still need simple translation (e.g. on 32-bit machine, use virtual address to subtract <code>0xC0000000</code> to get physical address)</li>
<li>it simplifies hardware support but consume memory for lifetime of virtual address space</li>
</ul>
</li>
<li>when store in the virtual memory: unused (cold) page table pages can be paged out to disk so that addressing page table may requires translation. (We don&#x27;t page the outer page table to aviod recursive page table)</li>
<li>that&#x27;s combine both, we have a wire page table in memory, the rest can be physical or virtual memory</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples:<a href="#examples" class="hash-link" aria-label="Direct link to Examples:" title="Direct link to Examples:">​</a></h4>
<p>for a process with 32 bits vitrual address space with 4kb pages:</p>
<ul>
<li>page number = 32 - 12 = 20 bits which implies totaly 2^20 pages which also means there are 2^20 entries in page table</li>
<li>page offset = 12 bits</li>
</ul>
<p>If 4 bytes per page table entry, then page table size is 2^20 * 4 = 1MB * 4 = 4MB</p>
<p>If there are 25 processes, then total memory is 25 * 4MB = 100MB</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="problems-on-page-table">Problems on Page Table<a href="#problems-on-page-table" class="hash-link" aria-label="Direct link to Problems on Page Table" title="Direct link to Problems on Page Table">​</a></h2>
<p>What is the virtual address is 48 bits? Then we have:</p>
<ul>
<li>page number = 48 - 12 = 36 bits which implies totaly 2^36 pages which also means there are 2^36 entries in page table</li>
<li>page offset = 12 bits</li>
<li>page table size is 2^36 * 4 = 2^30 * 2^6 * 4 = 1GB * 256 = 256GB for 4 bytes per page table entry</li>
</ul>
<p>How can we reduce the size of page table? One approach is to enlarge the page size. For example use 16KB page size, then we have:</p>
<ul>
<li>page number = 48 - 14 = 34 bits which implies totaly 2^34 pages which also means there are 2^34 entries in page table</li>
<li>page table size is 2^34 * 4 = 2^30 * 2^4 * 4 = 1GB * 64 = 64GB for 4 bytes per page table entry</li>
</ul>
<p>That is, we found the problem here that the small process with large page table</p>
<ul>
<li>for example a process with 1KB memory, then we have 4kb page size which will waste 3KB memory</li>
<li>and even worse for page table size</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution-to-save-space">Solution to Save Space<a href="#solution-to-save-space" class="hash-link" aria-label="Direct link to Solution to Save Space" title="Direct link to Solution to Save Space">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="segmented-paging">Segmented Paging<a href="#segmented-paging" class="hash-link" aria-label="Direct link to Segmented Paging" title="Direct link to Segmented Paging">​</a></h3>
<p>Segmented paging is a combination of segmentation and paging. It is a way to reduce the size of page table. The idea is to divide the virtual address space into segments and then divide each segment into pages. But:</p>
<ul>
<li>page table base and limit registers per segment</li>
<li>Limit number of regions which is inflexible</li>
<li>still waste on external fragmentation<!-- -->
<ul>
<li>page tables can be arbitrary size and requires contiguity but find free space get complicated</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="two-level-page-tables-multi-level-page-tables">Two-Level Page Tables (Multi-Level Page Tables)<a href="#two-level-page-tables-multi-level-page-tables" class="hash-link" aria-label="Direct link to Two-Level Page Tables (Multi-Level Page Tables)" title="Direct link to Two-Level Page Tables (Multi-Level Page Tables)">​</a></h3>
<p>By using two-level page tables, the virtual address is changed to: Page Directory Number + Page Table Number + Page Offset (again concat):</p>
<ul>
<li>page directory maps virtural page number to second-level page table and second-level page table maps virtual page number to page frame number</li>
<li>Page Directory Base Pointer (PDBR) is a register that points to the page directory</li>
</ul>
<p>For multi-level page tables, please read clearly the instruction.</p>
<ul>
<li>we can have table -&gt; table -&gt; ... -&gt; table -&gt; pte, but table size and pte size are different<!-- -->
<ul>
<li>e.g. For a 4-level table, using 9 bits to index each level, 8-byte pointers for the entry at each level, and 12 bytes for the PTE at the bottom, you need 4096 bytes for a table at each level, and 6144 bytes for each table at the bottom level. </li>
<li>but sometimes, we also may have using 9 bits to index each level, 8-byte pointers for the entry and additional 4-byte for additional info at each level, and 12 bytes for the PTE at the bottom, you need 6144 bytes for a table at each level, and 6144 bytes for each table at the bottom level.</li>
<li>the best case is that, all 8-byte pointers use.</li>
</ul>
</li>
<li>normally, 32 bit virtual memory system use 4-byte pte and 4kb page size<!-- -->
<ul>
<li>4-byte pte means 32 bits number</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h4>
<p>32 bits virtual address space with 4kb page size, 4 bytes per page table entry, then we have:</p>
<ul>
<li>page offset = 12 bits (same as before, the rest 12 bits of logical address from 4kb = 2^12)</li>
<li>Page Directory Number = 4kb / 4 bytes = 2^10 = 10 bits (why? since 4 bytes per page table entry and we have 4 kb page size, which means 2^10 entries in page table)</li>
<li>Page Table Number = 20(the remain 20 bits) - 10 = 10 bits</li>
</ul>
<p>even further, we can Multi-Level page tables, for example for a 48 bits virtual address space with 4kb page size, 8 bytes per page table entry, then we have:</p>
<ul>
<li>page offset = 12 bits (same as before, the rest 12 bits of logical address from 4kb = 2^12)</li>
<li>bits per levels = 4kb / 8 bytes = 2^9 = 9 bits</li>
<li>36/9 = 4 levels</li>
</ul>
<p>what if we dont have a specific pte size(normally no such situation exist, here for more understanding)? e.g. 32 bits virtual address space with 4kb page size, 5 level, then we have:</p>
<ul>
<li>page offset = 12 bits (same as before, the rest 12 bits of logical address from 4kb = 2^12)</li>
<li>table size per level = 20 / 5 = 4 bits</li>
<li>pte size = 2^12 / 2^4 = 2^8 = 256 bytes (why? since we want use all page? too big what we use for lolllll)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="more-types-of-page-table">More types of Page Table<a href="#more-types-of-page-table" class="hash-link" aria-label="Direct link to More types of Page Table" title="Direct link to More types of Page Table">​</a></h3>
<p>Hashed Page Tables: hash function maps virtual page number to bucket in fixed-sized hash table</p>
<p>Inverted Page Tables: keep one table with an entry for each physical page frame where entry records which virtual page # is stored in that frame and process id. That is reference uses virtual addresses, table is indexed by physical address.</p>
<ul>
<li>less space but slower lookup<!-- -->
<ul>
<li>can use hash to reduce the search time</li>
</ul>
</li>
<li>map keeps track of state of physical frames, can do fast allocation of physical frame and not used for address translation</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution-to-save-time">Solution to Save Time<a href="#solution-to-save-time" class="hash-link" aria-label="Direct link to Solution to Save Time" title="Direct link to Solution to Save Time">​</a></h2>
<p>Although paging is a good solution to save space, it also has some problems.</p>
<ul>
<li>memory reference time overhead, at least 2 memory references per access (worse for hierarchical page tables)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="translation-lookaside-buffer-tlb">Translation Lookaside Buffer (TLB)<a href="#translation-lookaside-buffer-tlb" class="hash-link" aria-label="Direct link to Translation Lookaside Buffer (TLB)" title="Direct link to Translation Lookaside Buffer (TLB)">​</a></h3>
<p>We can use hardware cache of lookups to save time. Further, TLB is:</p>
<ul>
<li>small, fully associative cache of page table entries (all entries looked up in parallel)</li>
<li>part of MMU,</li>
<li>translates virtual pages into PTEs that can be done in a single machine cycle.</li>
<li>TLB store TAG + PTE, where<!-- -->
<ul>
<li>Tages are virtual page numbers</li>
</ul>
</li>
</ul>
<p>There are two situation uses TLB (i.e. places needed address translation into the TLB):</p>
<ul>
<li>hardware-loaded (MMU)<!-- -->
<ul>
<li>Tables must be in hardware-defined format.</li>
<li>MMU knows where page tables are in main memory (PTBR) and OS maintains page tables in main memory. Hardware accesses them directly.</li>
</ul>
</li>
<li>Software-loaded (OS)<!-- -->
<ul>
<li>Tables can be in any format convenient to OS</li>
<li>TLB faults to OS, OS finds appropriate page table, loads into TLB<!-- -->
<ul>
<li>Some situation like TLB misses and a new PTE must be loaded, then a cached PTE must be evicted to make room for new PTE. (i.e. TLB replacement policy, implemented in hardware)</li>
</ul>
</li>
<li>must be fast (but still 20-200 cycles)</li>
<li>CPU ISA(Instruction Set Architecture) has instructions for manipulating TLB (i.e. add, read, invalidate, flush (invalidate all), etc.)</li>
<li>OS ensure that TLB and Page Table are consistent (i.e. invalidate the TLB entry when page table entry&#x27;s protection bits is changed)</li>
<li>Reload TLB on a process context switch (i.e. flush TLB), which is expensive</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="more-about-memory-allocation">more about memory allocation<a href="#more-about-memory-allocation" class="hash-link" aria-label="Direct link to more about memory allocation" title="Direct link to more about memory allocation">​</a></h2>
<p>We allocate memory for a process in two ways:</p>
<ol>
<li>fixed space algorithm:<!-- -->
<ul>
<li>each process is given a limit of pages it can use</li>
<li>when it reaches the limit, it replaces from its own pages (local replacement)</li>
<li>processes may do well while others may suffer (unfair)</li>
</ul>
</li>
<li>variable space algorithms:<!-- -->
<ul>
<li>process&#x27; set of pages grows and shrinks dynamically</li>
<li>can use global replacement: one process can ruin it for the rest</li>
<li>or local replacement: replacement and set size are separate</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sharing">Sharing<a href="#sharing" class="hash-link" aria-label="Direct link to Sharing" title="Direct link to Sharing">​</a></h3>
<p>When we introduce about process, we know that private virtual address spaces protect applcation from each other. We also know we can use some system call to share memory between processes. How can we implement it using paging?</p>
<ul>
<li>have PTEs in both tables map to the same physical frame, but its virtual address can differ or not<!-- -->
<ul>
<li>if different: flexible but pointer inside the shared memory segement are invalid (i.e. pointer uses virtual address)</li>
<li>if same: less flexible but shared pointers are valid.</li>
</ul>
</li>
<li>each PTE can have different protection values</li>
<li>must update both PTEs when page become invalid</li>
</ul>
<p>We also use copy-on-write to save memory. The idea is to share pages between parent and child processes until one of them writes to the page. Then the page is copied and the processes are no longer sharing the page.</p>
<ul>
<li>shared pages are marked read-only<!-- -->
<ul>
<li>Writes generate a protection fault, trap to OS, then copy page, change page mapping in page table, enable write permission, restart write instruction</li>
</ul>
</li>
<li><code>fork()</code> system call makes copy of process including virtual address space (no copy-on-write)</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/csc/csc369/06 Memory Management"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Memory Management</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/csc/csc369/08 Principles and Policies for Memory Management"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Principles and Policies for Memory Management</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#hardware-support" class="table-of-contents__link toc-highlight">Hardware Support</a></li><li><a href="#paging" class="table-of-contents__link toc-highlight">Paging</a><ul><li><a href="#support-for-paging" class="table-of-contents__link toc-highlight">Support for Paging</a></li><li><a href="#page-faults" class="table-of-contents__link toc-highlight">Page Faults</a></li><li><a href="#more-on-page-table" class="table-of-contents__link toc-highlight">More on Page Table</a></li></ul></li><li><a href="#problems-on-page-table" class="table-of-contents__link toc-highlight">Problems on Page Table</a></li><li><a href="#solution-to-save-space" class="table-of-contents__link toc-highlight">Solution to Save Space</a><ul><li><a href="#segmented-paging" class="table-of-contents__link toc-highlight">Segmented Paging</a></li><li><a href="#two-level-page-tables-multi-level-page-tables" class="table-of-contents__link toc-highlight">Two-Level Page Tables (Multi-Level Page Tables)</a></li><li><a href="#more-types-of-page-table" class="table-of-contents__link toc-highlight">More types of Page Table</a></li></ul></li><li><a href="#solution-to-save-time" class="table-of-contents__link toc-highlight">Solution to Save Time</a><ul><li><a href="#translation-lookaside-buffer-tlb" class="table-of-contents__link toc-highlight">Translation Lookaside Buffer (TLB)</a></li></ul></li><li><a href="#more-about-memory-allocation" class="table-of-contents__link toc-highlight">more about memory allocation</a><ul><li><a href="#sharing" class="table-of-contents__link toc-highlight">Sharing</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notes</a></li></ul></div><div class="col footer__col"><div class="footer__title">Yorafa&#x27;s Projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://coder.xfttech.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">UTLeetcoder<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://utodo.yorafa.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">UTodo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://home.yorafa.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Yorafa&#x27;s Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://yorafa.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Yorafa&#x27;s Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/Yorafa" target="_blank" rel="noopener noreferrer" class="footer__link-item">Yorafa&#x27;s Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Yorafa. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>