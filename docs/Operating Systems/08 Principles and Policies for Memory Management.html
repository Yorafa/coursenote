<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Operating Systems/08 Principles and Policies for Memory Management" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.1">
<title data-rh="true">Principles and Policies for Memory Management | Yorafa&#x27;s Note</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://note.yorafa.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://note.yorafa.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://note.yorafa.com/docs/Operating Systems/08 Principles and Policies for Memory Management"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Principles and Policies for Memory Management | Yorafa&#x27;s Note"><meta data-rh="true" name="description" content="Locality"><meta data-rh="true" property="og:description" content="Locality"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://note.yorafa.com/docs/Operating Systems/08 Principles and Policies for Memory Management"><link data-rh="true" rel="alternate" href="https://note.yorafa.com/docs/Operating Systems/08 Principles and Policies for Memory Management" hreflang="en"><link data-rh="true" rel="alternate" href="https://note.yorafa.com/docs/Operating Systems/08 Principles and Policies for Memory Management" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.9bb80656.css">
<script src="/assets/js/runtime~main.116c58f9.js" defer="defer"></script>
<script src="/assets/js/main.5562a3c0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/favicon.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Yorafa&#x27;s Note</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Notes</a><a href="https://home.yorafa.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Nav</a><a href="https://yorafa.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Yorafa/coursenote" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/basic">Basic</a><button aria-label="Expand sidebar category &#x27;Basic&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/algorithm">Algorithm</a><button aria-label="Expand sidebar category &#x27;Algorithm&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/deep-learning">Deep Learning</a><button aria-label="Expand sidebar category &#x27;Deep Learning&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/machine-learning">Machine Learning</a><button aria-label="Expand sidebar category &#x27;Machine Learning&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/nlp">NLP</a><button aria-label="Expand sidebar category &#x27;NLP&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/mat">MAT</a><button aria-label="Expand sidebar category &#x27;MAT&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/sta">STA</a><button aria-label="Expand sidebar category &#x27;STA&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/About">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Blog Backup/UTLeetcoder">Blog Backup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/Database">Database</a><button aria-label="Expand sidebar category &#x27;Database&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/DevOps/AWS/Outline">DevOps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Leetcode/1063">Leetcode</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/Operating Systems">Operating Systems</a><button aria-label="Collapse sidebar category &#x27;Operating Systems&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Operating Systems/00 intro">OS - three piece</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Operating Systems/01 process">Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Operating Systems/02 system call">System Call</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Operating Systems/03 thread">Thread</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Operating Systems/04 Synchronization">Synchronization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Operating Systems/05 Scheduling">Scheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Operating Systems/06 Memory Management">Memory Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Operating Systems/07 Paging and Address Translation">Paging and Address Translation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Operating Systems/08 Principles and Policies for Memory Management">Principles and Policies for Memory Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Operating Systems/09 file system introduction">File System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Operating Systems/10 file system reliability">File System Reliability</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/Operating Systems/Linux Programming/Bit">Linux Programming</a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/Operating Systems"><span itemprop="name">Operating Systems</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Principles and Policies for Memory Management</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Principles and Policies for Memory Management</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="locality">Locality<a href="#locality" class="hash-link" aria-label="Direct link to Locality" title="Direct link to Locality">​</a></h2>
<p>All paging schemes depend on locality where processes reference pages in localized patterns.</p>
<ul>
<li><strong>Temporal locality</strong>: locations referenced recently likely to be referenced again.</li>
<li><strong>Spatial locality</strong>: locations near recently referenced locations likely to be referenced soon.</li>
<li>Processees usually exhibit both kinds of locality during execution, making paging schemes effective and possible.</li>
<li>All caching strategies depend on locality to be effective.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="working-set">Working Set<a href="#working-set" class="hash-link" aria-label="Direct link to Working Set" title="Direct link to Working Set">​</a></h3>
<p>We define a <strong>working set</strong> of a process to be used to model the dynamic locality of its memory usage. where:</p>
<ul>
<li><code>WS(t, D)</code> = pages <code>P</code> such that <code>P</code> is referenced during the time interval <code>[t, t - D)</code></li>
<li><code>t</code> = time, <code>D</code> = working set window</li>
<li>a page is in the working set only if it was referenced in the last <code>D</code> time references</li>
<li>the working set size is # of pages in the working set</li>
<li>working set size changes with program locality<!-- -->
<ul>
<li>poor locality leads more pages</li>
<li>within the period of time, working set size is larger</li>
</ul>
</li>
<li>we want working set to be the set of pages that needed in memory to prevent heavy faulting<!-- -->
<ul>
<li>each processs has a parameter <code>D</code> that determines a working set with few faults</li>
<li>don&#x27;t run a process unless working set is in memory</li>
</ul>
</li>
</ul>
<p>The problems of working set are:</p>
<ul>
<li>how to determine <code>D</code>?</li>
<li>how do we know when the working set changes?</li>
<li>not used in paging systems</li>
</ul>
<h1>Policy Decisions</h1>
<p>Page tables, MMU, TLB, etc. are mechanisms make virtual memory possible, but we need policies for virtual memory to be effective:</p>
<ul>
<li><strong>Fetch policy</strong>: when to fetch a page (Demand paging V.S. Prepaging)</li>
<li><strong>Placement policy</strong>: where to put the page (some physical pages preferable to others?)</li>
<li><strong>Replacement policy</strong>: what page to replace when needed</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fetch-policy">Fetch Policy<a href="#fetch-policy" class="hash-link" aria-label="Direct link to Fetch Policy" title="Direct link to Fetch Policy">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="demand-paging">Demand Paging<a href="#demand-paging" class="hash-link" aria-label="Direct link to Demand Paging" title="Direct link to Demand Paging">​</a></h3>
<p>Recall demand paging from the OS perspective:</p>
<ul>
<li>OS allocates a page frame, read page from disk</li>
<li>pages are evicted to disk when memory is full</li>
<li>pages loaded from disk when referenced again</li>
<li>references to evicted pages cause a TLB miss (page fault when invalid PTE)<!-- -->
<ul>
<li>when I/O completes, the OS fills in PTE, marks it valid, resume process, retry faulting instruction</li>
</ul>
</li>
<li>only dirty pages (or we say modified pages) are written back to disk, clean pages do not but need to know where on disk to find them</li>
</ul>
<p>Demand paging from the Process perspective:</p>
<ul>
<li>used when a process first starts up, specifically when a process is created then:<!-- -->
<ul>
<li>a brand new page table with all valid bits off</li>
<li>no pages in memory</li>
</ul>
</li>
<li>when the process starts executing:<!-- -->
<ul>
<li>instructions fault on code and data pages (since no pages in memory)</li>
<li>faulting stops when all necessary code and data pages are in memory</li>
<li>only code and data needed by a process needs to be loaded</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prepaging">Prepaging<a href="#prepaging" class="hash-link" aria-label="Direct link to Prepaging" title="Direct link to Prepaging">​</a></h3>
<p>Prepaging: predict future page use at time of current fault. It is a good idea to bring in more pages than the one demanded by the faulting instruction but how many? That is, it&#x27;s always unpredictable how many pages will be needed in the future.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="placement-policy">Placement Policy<a href="#placement-policy" class="hash-link" aria-label="Direct link to Placement Policy" title="Direct link to Placement Policy">​</a></h2>
<p>In paging system, memory management hardware can translate any virtual-to-physical mapping equally well. But why we need to consider some physical pages preferable to others?</p>
<ul>
<li>Non-Uniform Memory Access (NUMA) Multiprocessors: any processor can access entire memory, but local memory is faster</li>
<li>Cache performance: choose physical pages to minimize cache conflicts</li>
<li>placement policy will have smaller effect than fetch and replacement policies if memory is limited</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="replacement-policy">Replacement Policy<a href="#replacement-policy" class="hash-link" aria-label="Direct link to Replacement Policy" title="Direct link to Replacement Policy">​</a></h2>
<p>When memory is full, we need to evict a page to make room for a new page. We need to choose a page to evict, but how? Notice that the goal is to reduce the fault rate by selecting the best victim page to remove (i.e. ideally, the page to evict is the one never used again)</p>
<p>But as we do replacement, we should make algorithms to avoid thrashing. We define thrashing following:</p>
<ul>
<li>when more time is spent by the OS in paging than executing</li>
<li>No time spent doing useful work</li>
</ul>
<p>If thrashing happends, the system is overcommitted:</p>
<ul>
<li>no idea which pages should be in memory to reduce faults</li>
<li>maybe there just isn&#x27;t enough physical memory for all the processes</li>
</ul>
<p>Some possibloe solutions are:</p>
<ul>
<li>swapping: write out all pages of a process and suspend it</li>
<li>in linux: kill some processes until enough memory is available (i.e. Out-of-Memory (OOM) killer)</li>
<li>buy more memory (i.e. add more RAM)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="beladys-algorithm">Belady&#x27;s algorithm<a href="#beladys-algorithm" class="hash-link" aria-label="Direct link to Belady&#x27;s algorithm" title="Direct link to Belady&#x27;s algorithm">​</a></h3>
<p>This algorithm evicts the page that won’t be used for the longest period of time minimizes the number of page faults. It also known as the <strong>OPT</strong> (optimal) algorithm due to it has lowest fault rate for any page reference string. The only problem is that have to know the future perfectly.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fifo">FIFO<a href="#fifo" class="hash-link" aria-label="Direct link to FIFO" title="Direct link to FIFO">​</a></h3>
<p>FIFO is an obvious algorithm and simple to implement where it  maintain a list of pages in order in which they were paged in.</p>
<ul>
<li>On replacement, evict the one brought in longest time ago</li>
<li>Maybe the one brought in the longest ago is not being used (good)</li>
<li>No information about a page except its age in memory (bad)</li>
<li>FIFO suffers from “Belady’s Anomaly” where the fault rate might actually increase when the algorithm is given more memory (Very bad!)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lru">LRU<a href="#lru" class="hash-link" aria-label="Direct link to LRU" title="Direct link to LRU">​</a></h3>
<p>LRU(Least Recently Used) use reference information too make a more informed replacement decision. This algorithm evicts the page that has not been used for the longest period of time.</p>
<p>There are two options to implement LRU:</p>
<ul>
<li>Time stamp every reference and evict page with oldest time stamp. It has the following problems:<!-- -->
<ul>
<li>requires hardware support and larger PTEs to store meaningful time stamps (time stamping every reference is expensive, e.g. day-second-millisecond counter)</li>
<li>need to loop over all pages to find the oldest one</li>
</ul>
</li>
<li>keep pages in double-end queue. Move page to the front when referenced, evict page at the end. It has the following problems:<!-- -->
<ul>
<li>need costly operations to maintain the queue</li>
</ul>
</li>
</ul>
<p>approximating LRU: We can use PTE reference bit to approximate LRU where r-bit is set to 1 when the page is referenced. We also maintain a counter for each page where pages with larger value vounters were used more recently.</p>
<p>Both LRU and MRU are based on the idea that count number of uses of a page. But neither is common, both are poor approximations of OPT.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clock">Clock<a href="#clock" class="hash-link" aria-label="Direct link to Clock" title="Direct link to Clock">​</a></h3>
<p>We also have second-chance algorithm where use FIFO but inspect reference bit when page is selected.</p>
<ul>
<li>If reference bit is 0, evict page</li>
<li>If reference bit is 1, clear bit, move page to end of FIFO, and repeat</li>
<li>can combine with modified bit which called <strong>NFU</strong> (Not Frequently Used) algorithm</li>
</ul>
<p>One implementaion is clock where use a clock hand to loop over all pages again and again just like clock.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="s2q">S2Q<a href="#s2q" class="hash-link" aria-label="Direct link to S2Q" title="Direct link to S2Q">​</a></h3>
<p>We can also combine the recency and frequency information to work better. The basic idea is that single-use pages should be replaced quickly (i.e. don&#x27;t evict pages that are likely to be used again). Variations of this idea (e.g. LRU/k, 2Q, ARC, LIRS) also called <strong>scan-resistant algorithms</strong>.</p>
<p>One implementation introduced here is S2Q (Simplified 2Q). We maintain two queues, limited-size FIFO queue and LRU order queue (doubly-queue best).</p>
<ul>
<li>when reference page <code>p</code>:<!-- -->
<ul>
<li>if <code>p</code> is in LRU queue, move it to the front of the queue (i.e. most recently used. it&#x27;s depend on how you define LRU that is can be end of the queue if you define LRU as the front)</li>
<li>if <code>p</code> is in FIFO queue, move it to the front of the LRU queue</li>
<li>if <code>p</code> is not in any queue, add it to FIFO queue</li>
</ul>
</li>
<li>when evict page, evict the oldest page in FIFO queue when FIFO queue is full. Otherwise, evict the LRU page in LRU queue</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="some-os-paging-policy">Some OS paging policy<a href="#some-os-paging-policy" class="hash-link" aria-label="Direct link to Some OS paging policy" title="Direct link to Some OS paging policy">​</a></h2>
<p>Windows XP:</p>
<ul>
<li>4KB page size on IA32 processors/8KB on IA64 processors</li>
<li>4GB virtual address space, upper 2GB used by XP kernel</li>
<li>Multi-level page tables</li>
<li>page frames are tracked using a page frame database with one entry per page of physical memory</li>
<li>local page replacement policy:<!-- -->
<ul>
<li>per-process FIFO (use for page) and processes start with a default of 50 pages</li>
<li>pages are stolen from processes using more than their minimum working set size</li>
<li>XP monitors page fault rate and adjusts working-set size accordingly</li>
<li>when page fault, cluster of pages around the missing page are brought into memory</li>
</ul>
</li>
</ul>
<p>Linux:</p>
<ul>
<li>global page replacement policy (like most UNIX)</li>
<li>use 2 lists (similar to S2Q)<!-- -->
<ul>
<li>&quot;Hot&quot; pages on active list, managed using a Clock-like approximation of LRU.</li>
<li>&quot;Cold&quot; pages on inactive list, managed using FIFO</li>
</ul>
</li>
<li>Pages start on inactive_list<!-- -->
<ul>
<li>On first use, PG_referenced flag is set, page stays on inactive_list.</li>
<li>On second use (i.e. PG_referenced already set), page moves to head of active_list.</li>
</ul>
</li>
<li>When there are too few free pages:<!-- -->
<ul>
<li>Move some pages from tail of active_list to head of inactive_list.<!-- -->
<ul>
<li>If PG_referenced flag is set, clear it and move page to head of active_list .</li>
</ul>
</li>
<li>Free some pages from tail of inactive_list.</li>
</ul>
</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Operating Systems/07 Paging and Address Translation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Paging and Address Translation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Operating Systems/09 file system introduction"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">File System</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#locality" class="table-of-contents__link toc-highlight">Locality</a><ul><li><a href="#working-set" class="table-of-contents__link toc-highlight">Working Set</a></li></ul></li><li><a href="#fetch-policy" class="table-of-contents__link toc-highlight">Fetch Policy</a><ul><li><a href="#demand-paging" class="table-of-contents__link toc-highlight">Demand Paging</a></li><li><a href="#prepaging" class="table-of-contents__link toc-highlight">Prepaging</a></li></ul></li><li><a href="#placement-policy" class="table-of-contents__link toc-highlight">Placement Policy</a></li><li><a href="#replacement-policy" class="table-of-contents__link toc-highlight">Replacement Policy</a><ul><li><a href="#beladys-algorithm" class="table-of-contents__link toc-highlight">Belady&#39;s algorithm</a></li><li><a href="#fifo" class="table-of-contents__link toc-highlight">FIFO</a></li><li><a href="#lru" class="table-of-contents__link toc-highlight">LRU</a></li><li><a href="#clock" class="table-of-contents__link toc-highlight">Clock</a></li><li><a href="#s2q" class="table-of-contents__link toc-highlight">S2Q</a></li></ul></li><li><a href="#some-os-paging-policy" class="table-of-contents__link toc-highlight">Some OS paging policy</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notes</a></li></ul></div><div class="col footer__col"><div class="footer__title">Yorafa&#x27;s Projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://coder.xfttech.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">UTLeetcoder<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://utodo.yorafa.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">UTodo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://huxulm.github.io/lc-rating/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LC-Rating<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://home.yorafa.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Yorafa&#x27;s Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://yorafa.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Yorafa&#x27;s Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/Yorafa" target="_blank" rel="noopener noreferrer" class="footer__link-item">Yorafa&#x27;s Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Yorafa. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>