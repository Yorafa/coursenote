"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1779],{8207:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"Operating Systems/Linux Programming/Socket","title":"Socket","description":"Before we talk about socket, we should probably know how the internet\'s workflow.","source":"@site/docs/Operating Systems/Linux Programming/Socket.md","sourceDirName":"Operating Systems/Linux Programming","slug":"/Operating Systems/Linux Programming/Socket","permalink":"/docs/Operating Systems/Linux Programming/Socket","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Signal","permalink":"/docs/Operating Systems/Linux Programming/Signal"},"next":{"title":"String","permalink":"/docs/Operating Systems/Linux Programming/String"}}');var c=s(4848),t=s(8453);const d={},i="Socket",o={},l=[{value:"bind system call",id:"bind-system-call",level:2},{value:"listen system call",id:"listen-system-call",level:2},{value:"accept system call",id:"accept-system-call",level:2},{value:"connect system call",id:"connect-system-call",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"socket",children:"Socket"})}),"\n",(0,c.jsx)(n.p,{children:"Before we talk about socket, we should probably know how the internet's workflow."}),"\n",(0,c.jsx)(n.p,{children:"When we send message, we actually send a data package to some servers. And those servers will send the those data package to to specific ports according to the data package description. And the software in that port will work on our data package and send back the information we need. Some ports we always use:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"80: http default port"}),"\n",(0,c.jsx)(n.li,{children:"443: https default port"}),"\n",(0,c.jsx)(n.li,{children:"25565: Minecraft default port"}),"\n",(0,c.jsx)(n.li,{children:"23:  Telnet (part of TCP/IP)"}),"\n",(0,c.jsx)(n.li,{children:"21 : FTP"}),"\n",(0,c.jsx)(n.li,{children:"..."}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"int socket(int domain, int type, int protocol):"})," return a file descriptor or ",(0,c.jsx)(n.code,{children:"-1"})," on error"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"domain"}),": set the rule of  ",(0,c.jsx)(n.code,{children:"protocol"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"type"}),": the type of sockets"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"protocol"}),": use ",(0,c.jsx)(n.code,{children:"0"})," to tell system use default"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"The domain:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"AF_INET:"})," Address family internet (same as ",(0,c.jsx)(n.code,{children:"PF_INET"}),")"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"PF_INET"}),": Protocol family internet (same as ",(0,c.jsx)(n.code,{children:"AF_INET"}),")"]}),"\n",(0,c.jsx)(n.li,{children:"..."}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"There are many types sockets:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"SOCK_DGRAM"}),": Datagram sockets"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"SOCK_STREAM"})," : Stream sockets(TCP), connection-oriented sockets, no loss guaranteed and ordered delivery"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"SOCK_RAW"}),": Raw sockets"]}),"\n",(0,c.jsx)(n.li,{children:"..."}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"And we have a structure to store socket information:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-c",children:"struct sockaddr_in{\r\n    short sin_family;\r\n    u_short sin_port;\r\n    struct in_addr sin_addr;\r\n    char sin_zero[8];\r\n}\n"})}),"\n",(0,c.jsxs)(n.p,{children:["The above socket address is one of the socket address we can use in ",(0,c.jsx)(n.code,{children:"sockaddr"})," by ",(0,c.jsx)(n.code,{children:"(struct sockaddr) &addr_in"})]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"sin_family"}),": same as the socket family"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"sin_port"}),": the port will be listen to, we will use ",(0,c.jsx)(n.code,{children:"htons(int portsNum)"})," to refer this value where ",(0,c.jsx)(n.code,{children:"htons"})," stands hosts-to-network-short"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"sin_addr"}),": server will usually set as any. for example ",(0,c.jsx)(n.code,{children:"sin_addr.s_addr = INADDR_ANY"}),", client will set it the server address"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"sin_zero"}),": will usually set as 0 by ",(0,c.jsx)(n.code,{children:"memset"})]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["For ",(0,c.jsx)(n.code,{children:".sin_addr"})," we can use ",(0,c.jsx)(n.code,{children:"inet_pton"})," function to convert IPV4 and IPV6 addresses from text to binary form.\\"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"int inet_pton(int af, const char *src, void *dst):"})," return 1 on successful convert or -1 on error or 0 if text does not contain a valid network address."]}),"\n",(0,c.jsx)(n.h2,{id:"bind-system-call",children:"bind system call"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen):"})," return 0 if bind success or ",(0,c.jsx)(n.code,{children:"-1"})," on error"]}),"\n",(0,c.jsx)(n.h2,{id:"listen-system-call",children:"listen system call"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"int listen(int sockfd, int backlog)"}),": return 0 success or ",(0,c.jsx)(n.code,{children:"-1"})," on error"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"backlog"})," the max number of partial connections the server can hold"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"accept-system-call",children:"accept system call"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"int accept(int sockfd, struct sockaddr *addr, socklen_t  *addlen)"}),": return a new socket file descriptor use to communicate with the client, or ",(0,c.jsx)(n.code,{children:"-1"})," on error"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"addr"}),": we should create a new ",(0,c.jsx)(n.code,{children:"struct scokaddr_in"})," for client address to store its data"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"addlen"}),": the ",(0,c.jsx)(n.code,{children:"sizeof(addr)"})]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"accept will blocking system 'till connections"}),"\n",(0,c.jsx)(n.h2,{id:"connect-system-call",children:"connect system call"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"int connect(int sockfd, const struct sockaddr *address, socklen_t addrlen):"}),"return a new socket file descriptor use to communicate with the server, or ",(0,c.jsx)(n.code,{children:"-1"})," on error"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"address"}),": use ",(0,c.jsx)(n.code,{children:"getaddrinfo"})," to write ",(0,c.jsx)(n.code,{children:"result"})," and cast ",(0,c.jsx)(n.code,{children:"result->ai_addr"})," into ",(0,c.jsx)(n.code,{children:"sockaddr"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"addrlen"}),": the ",(0,c.jsx)(n.code,{children:"sizeof(address"}),")`"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"int getaddrinfo(char *host, char *service, stuct addrinfo *hints, struct addrinfo **result):"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"host"}),": the domain name"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"service"}),": for page we don't care"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"hints"}),": for page we don't care"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"result"}),": use a new ",(0,c.jsx)(n.code,{children:"struct addrinfo"})," to store the server info"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>i});var r=s(6540);const c={},t=r.createContext(c);function d(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);